---
export const prerender = true;

import Layout from "@layouts/Layout.astro";
import Container from "@components/Container.astro";
import { SITE, HOME, SOCIALS } from "@consts";
import ArrowCard from "@components/ArrowCard.astro";
import Link from "@components/Link.astro";
import { getCollection } from "astro:content";
import { Icon } from "astro-icon/components";
import HomeContent from "@content/home.mdx";
import LazyAsciiBuddy from "@components/LazyAsciiBuddy";

const blog = (await getCollection("blog"))
  .filter((post) => !post.data.draft)
  .sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf())
  .slice(0, SITE.NUM_POSTS_ON_HOMEPAGE);

const projects = (await getCollection("projects"))
  .filter((project) => !project.data.draft)
  .sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf())
  .slice(0, SITE.NUM_PROJECTS_ON_HOMEPAGE);

const EMAIL_DISPLAY = "[firstname]@[lastname].sh";
---

<Layout title={HOME.TITLE} description={HOME.DESCRIPTION}>
  <Container>
    <aside data-pagefind-ignore>
      <div class="space-y-16">
        <section class="grid items-start gap-6 lg:grid-cols-[1.6fr,1fr]">
          <article>
            <HomeContent />
          </article>
          <div class="not-prose">
            <LazyAsciiBuddy client:only="react" />
          </div>
        </section>

        <section class="animate space-y-6">
          <div class="flex flex-wrap items-center justify-between gap-y-2">
            <h2 class="font-semibold text-black dark:text-white">
              Latest Posts
            </h2>
            <Link href="/blog"> See all posts </Link>
          </div>
          <ul class="not-prose flex flex-col gap-4">
            {
              blog.map((post) => (
                <li>
                  <ArrowCard entry={post} />
                </li>
              ))
            }
          </ul>
        </section>

        <section class="animate space-y-6">
          <div class="flex flex-wrap items-center justify-between gap-y-2">
            <h2 class="font-semibold text-black dark:text-white">
              Recent Projects
            </h2>
            <Link href="/projects"> See all projects </Link>
          </div>
          <ul class="not-prose flex flex-col gap-4">
            {
              projects.map((project) => (
                <li>
                  <ArrowCard entry={project} />
                </li>
              ))
            }
          </ul>
        </section>

        <section id="contact-info" class="animate space-y-4">
          <h2 class="font-semibold text-black dark:text-white">Contact Info</h2>
          <article>
            <p>
              If you want to get in touch with me about something or just to say
              hi, reach out on social media or send me an email. I'm always open
              to meeting new people and interesting conversations.
            </p>
          </article>
          <ul class="not-prose flex flex-col gap-2">
            {
              SOCIALS.map((SOCIAL) => (
                <li class="flex items-center gap-x-2">
                  <Icon name={SOCIAL.ICON} class="h-5 w-5" />
                  <Link
                    href={SOCIAL.HREF}
                    external
                    aria-label={`${SITE.TITLE} on ${SOCIAL.NAME}`}
                  >
                    {SOCIAL.NAME}
                  </Link>
                </li>
              ))
            }
            <li class="flex items-center gap-x-2">
              <Icon name="mdi:file-document" class="h-5 w-5" />
              <Link href="/resume.pdf" external aria-label="View resume">
                Resume (PDF)
              </Link>
            </li>
            <li class="flex items-center gap-x-2">
              <Icon name="mdi:email" class="h-5 w-5" />
              <Link
                href={`mailto:${EMAIL_DISPLAY}`}
                aria-label={`Email ${SITE.TITLE}`}
              >
                {EMAIL_DISPLAY}
              </Link>
            </li>
          </ul>
        </section>
      </div>
    </aside>
  </Container>
</Layout>
